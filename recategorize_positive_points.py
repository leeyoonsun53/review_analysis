# -*- coding: utf-8 -*-
"""
Positive Points 재분류 - 유사한 표현 통합
"""
import json
import sys

sys.stdout.reconfigure(encoding='utf-8')

# Positive Points 매핑 (유사 표현 → 대표 표현)
POSITIVE_MAPPING = {
    # === 순함/자극없음 ===
    '순함': '순함/저자극',
    '순하다': '순함/저자극',
    '순한 제품': '순함/저자극',
    '순한 사용감': '순함/저자극',
    '자극 없음': '순함/저자극',
    '자극없이 순함': '순함/저자극',
    '자극이 없음': '순함/저자극',
    '자극없음': '순함/저자극',
    '자극이 없다': '순함/저자극',
    '자극 없이 순함': '순함/저자극',
    '자극적이지 않음': '순함/저자극',
    '순하고 자극 없음': '순함/저자극',
    '순해서 좋음': '순함/저자극',
    '순하게 사용 가능': '순함/저자극',
    '저자극': '순함/저자극',
    '자극이 적음': '순함/저자극',
    '자극 없이 사용 가능': '순함/저자극',
    '피부 자극 없음': '순함/저자극',
    '순한 성분': '순함/저자극',
    '자극없이 좋음': '순함/저자극',
    '순해요': '순함/저자극',

    # === 촉촉함/보습 ===
    '촉촉함': '촉촉함/보습',
    '수분감': '촉촉함/보습',
    '보습': '촉촉함/보습',
    '보습 효과': '촉촉함/보습',
    '수분 충전': '촉촉함/보습',
    '촉촉하다': '촉촉함/보습',
    '보습력': '촉촉함/보습',
    '촉촉해요': '촉촉함/보습',
    '보습감': '촉촉함/보습',
    '수분 공급': '촉촉함/보습',
    '촉촉하게 됨': '촉촉함/보습',
    '수분감 좋음': '촉촉함/보습',
    '보습력 좋음': '촉촉함/보습',
    '촉촉함이 좋음': '촉촉함/보습',
    '수분 보충': '촉촉함/보습',
    '보습 좋음': '촉촉함/보습',
    '촉촉': '촉촉함/보습',
    '수분감이 좋음': '촉촉함/보습',
    '보습 효과 좋음': '촉촉함/보습',
    '속건조 개선': '촉촉함/보습',

    # === 재구매 의사 ===
    '재구매 의사': '재구매 의사',
    '재구매': '재구매 의사',
    '재구매 의사 있음': '재구매 의사',
    '재구매템': '재구매 의사',
    '재구매 예정': '재구매 의사',
    '재구매할 예정': '재구매 의사',
    '재구매 할 것': '재구매 의사',
    '또 살 것': '재구매 의사',
    '재구매 확정': '재구매 의사',
    '재구매 하고 싶음': '재구매 의사',

    # === 가성비 ===
    '가성비': '가성비/저렴',
    '가성비 좋음': '가성비/저렴',
    '저렴한 가격': '가성비/저렴',
    '가격이 저렴하다': '가성비/저렴',
    '가격 대비 좋음': '가성비/저렴',
    '가격이 저렴함': '가성비/저렴',
    '가성비 좋다': '가성비/저렴',
    '저렴함': '가성비/저렴',
    '가격이 착함': '가성비/저렴',
    '가성비가 좋음': '가성비/저렴',
    '가격이 좋음': '가성비/저렴',
    '저렴': '가성비/저렴',
    '가성비 갑': '가성비/저렴',
    '착한 가격': '가성비/저렴',

    # === 대용량 ===
    '대용량': '대용량',
    '양이 많음': '대용량',
    '용량이 많음': '대용량',
    '넉넉한 용량': '대용량',
    '용량이 넉넉함': '대용량',
    '양이 넉넉함': '대용량',
    '용량 많음': '대용량',
    '많은 양': '대용량',
    '양 많음': '대용량',
    '용량이 많아서 좋음': '대용량',

    # === 진정 효과 ===
    '진정 효과': '진정 효과',
    '피부 진정': '진정 효과',
    '피부 진정 효과': '진정 효과',
    '진정효과': '진정 효과',
    '진정됨': '진정 효과',
    '진정': '진정 효과',
    '진정 효과 있음': '진정 효과',
    '피부가 진정됨': '진정 효과',
    '진정 효과 좋음': '진정 효과',

    # === 무난함 ===
    '무난함': '무난함',
    '무난하게 쓰기 좋음': '무난함',
    '무난하게 사용 가능': '무난함',
    '무난하게 사용하기 좋음': '무난함',
    '무난하다': '무난함',
    '무난하게 좋음': '무난함',
    '무난하게 사용': '무난함',
    '무난무난': '무난함',
    '무난하게 쓸 수 있음': '무난함',

    # === 흡수 잘됨 ===
    '흡수 잘됨': '흡수 좋음',
    '빠른 흡수': '흡수 좋음',
    '흡수 빠름': '흡수 좋음',
    '흡수력 좋음': '흡수 좋음',
    '흡수가 잘됨': '흡수 좋음',
    '흡수가 빠름': '흡수 좋음',
    '빠르게 흡수됨': '흡수 좋음',
    '흡수력': '흡수 좋음',
    '흡수 좋음': '흡수 좋음',
    '잘 스며듦': '흡수 좋음',

    # === 끈적임 없음 ===
    '끈적이지 않음': '산뜻함/비끈적',
    '끈적임 없음': '산뜻함/비끈적',
    '산뜻함': '산뜻함/비끈적',
    '산뜻하다': '산뜻함/비끈적',
    '산뜻한 사용감': '산뜻함/비끈적',
    '끈적거리지 않음': '산뜻함/비끈적',
    '산뜻해요': '산뜻함/비끈적',
    '끈적임이 없음': '산뜻함/비끈적',
    '산뜻': '산뜻함/비끈적',
    '가벼움': '산뜻함/비끈적',
    '가벼운 제형': '산뜻함/비끈적',
    '가볍다': '산뜻함/비끈적',
    '가벼운 사용감': '산뜻함/비끈적',

    # === 만족/좋음 ===
    '좋음': '만족',
    '좋아요': '만족',
    '좋다': '만족',
    '너무 좋아요': '만족',
    '만족': '만족',
    '좋아': '만족',
    '너무 좋음': '만족',
    '만족스러움': '만족',
    '아주 좋음': '만족',
    '정말 좋아요': '만족',
    '매우 만족': '만족',
    '대만족': '만족',
    '최고': '만족',

    # === 추천 ===
    '추천': '추천',
    '추천합니다': '추천',
    '추천해요': '추천',
    '강추': '추천',
    '추천함': '추천',

    # === 트러블 없음 ===
    '트러블 없음': '트러블 없음',
    '트러블이 없음': '트러블 없음',
    '뾰루지 안남': '트러블 없음',
    '트러블 안남': '트러블 없음',
    '피부 트러블 없음': '트러블 없음',

    # === 민감성 피부 적합 ===
    '민감성 피부에 적합': '민감성 피부 적합',
    '민감한 피부에 좋음': '민감성 피부 적합',
    '민감 피부에 적합': '민감성 피부 적합',
    '예민한 피부에 적합': '민감성 피부 적합',
    '민감성 피부 추천': '민감성 피부 적합',

    # === 화장 잘 먹음 ===
    '화장 잘 먹음': '화장 잘 받음',
    '화장이 잘 먹음': '화장 잘 받음',
    '메이크업 베이스로 좋음': '화장 잘 받음',
    '화장 잘 받음': '화장 잘 받음',
    '화장 전에 쓰기 좋음': '화장 잘 받음',

    # === 무향 ===
    '무향': '무향/향 좋음',
    '향이 좋음': '무향/향 좋음',
    '향 좋음': '무향/향 좋음',
    '향이 없음': '무향/향 좋음',
    '은은한 향': '무향/향 좋음',

    # === 시원함 ===
    '시원함': '시원함',
    '시원하다': '시원함',
    '청량감': '시원함',
    '쿨링감': '시원함',
    '시원한 느낌': '시원함',

    # === 사계절 사용 ===
    '사계절 사용 가능': '사계절 사용',
    '여름에 사용하기 좋음': '사계절 사용',
    '겨울에도 사용 가능': '사계절 사용',
    '여름에 좋음': '사계절 사용',
    '사계절': '사계절 사용',

    # === 좋은 사용감 ===
    '좋은 사용감': '좋은 사용감',
    '사용감 좋음': '좋은 사용감',
    '사용하기 좋음': '좋은 사용감',
    '쓰기 좋음': '좋은 사용감',
    '사용감이 좋음': '좋은 사용감',
}


def recategorize_positive_points():
    print("Positive Points 재분류 시작...")

    # 데이터 로드
    with open('output/gpt_analysis_categorized.json', 'r', encoding='utf-8') as f:
        cat_data = json.load(f)

    print(f"총 {len(cat_data):,}건 분석 데이터")

    # 재분류 전 통계
    before_pos = {}
    for r in cat_data:
        for p in r.get('positive_points', []):
            before_pos[p] = before_pos.get(p, 0) + 1
    print(f"재분류 전 고유 Positive Points: {len(before_pos)}개")

    # 재분류 적용
    mapped_count = 0
    for r in cat_data:
        new_pos_points = []
        for p in r.get('positive_points', []):
            if p in POSITIVE_MAPPING:
                new_pos_points.append(POSITIVE_MAPPING[p])
                mapped_count += 1
            else:
                new_pos_points.append(p)
        # 중복 제거 (같은 카테고리로 매핑된 경우)
        r['positive_points'] = list(dict.fromkeys(new_pos_points))

    print(f"매핑 적용: {mapped_count}건")

    # 재분류 후 통계
    after_pos = {}
    for r in cat_data:
        for p in r.get('positive_points', []):
            after_pos[p] = after_pos.get(p, 0) + 1
    print(f"재분류 후 고유 Positive Points: {len(after_pos)}개")

    # 저장
    with open('output/gpt_analysis_categorized.json', 'w', encoding='utf-8') as f:
        json.dump(cat_data, f, ensure_ascii=False, indent=2)

    print("\n=== 재분류 후 TOP 20 Positive Points ===")
    sorted_after = sorted(after_pos.items(), key=lambda x: -x[1])
    for i, (p, c) in enumerate(sorted_after[:20], 1):
        print(f"{i}. {p}: {c}건")

    return after_pos


if __name__ == "__main__":
    recategorize_positive_points()
