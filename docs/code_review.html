<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>리뷰 분석 프로젝트 - 코드 분석 및 기획서</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f3f4f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            line-height: 1.7;
            color: var(--dark);
            background: var(--light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .toc {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .toc h2 {
            color: var(--primary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .toc ul {
            list-style: none;
            columns: 2;
        }

        .toc li {
            padding: 8px 0;
        }

        .toc a {
            color: var(--dark);
            text-decoration: none;
            transition: color 0.3s;
        }

        .toc a:hover {
            color: var(--primary);
        }

        section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }

        section h3 {
            color: var(--secondary);
            margin: 25px 0 15px 0;
        }

        section h4 {
            color: var(--dark);
            margin: 20px 0 10px 0;
        }

        .module-card {
            background: var(--light);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }

        .module-card h4 {
            margin-top: 0;
            color: var(--primary);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
        }

        .badge-primary { background: #dbeafe; color: var(--primary); }
        .badge-success { background: #d1fae5; color: var(--success); }
        .badge-warning { background: #fef3c7; color: var(--warning); }
        .badge-danger { background: #fee2e2; color: var(--danger); }
        .badge-purple { background: #ede9fe; color: var(--secondary); }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background: #f9fafb;
        }

        code {
            background: #1e293b;
            color: #e2e8f0;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 15px 0;
        }

        .flow-diagram {
            background: linear-gradient(to right, #f0f9ff, #e0f2fe);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }

        .flow-step {
            display: inline-block;
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-weight: 600;
        }

        .flow-arrow {
            display: inline-block;
            font-size: 1.5rem;
            color: var(--primary);
            margin: 0 10px;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .pros {
            background: #d1fae5;
            border-radius: 8px;
            padding: 20px;
        }

        .cons {
            background: #fee2e2;
            border-radius: 8px;
            padding: 20px;
        }

        .pros h4 { color: var(--success); }
        .cons h4 { color: var(--danger); }

        .pros ul, .cons ul {
            margin-left: 20px;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: var(--light);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .metric-card .number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .metric-card .label {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .alert-info {
            background: #dbeafe;
            border-left: 4px solid var(--primary);
        }

        .alert-warning {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
        }

        .alert-success {
            background: #d1fae5;
            border-left: 4px solid var(--success);
        }

        footer {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .toc ul { columns: 1; }
            .pros-cons { grid-template-columns: 1fr; }
            header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1>리뷰 분석 프로젝트</h1>
        <p>올리브영 토너 리뷰 데이터 분석 시스템 - 코드 분석 및 기획서</p>
        <p style="margin-top: 15px; opacity: 0.8;">문서 생성일: 2026-01-27</p>
    </header>

    <div class="container">
        <!-- 목차 -->
        <nav class="toc">
            <h2>목차</h2>
            <ul>
                <li><a href="#overview">1. 프로젝트 개요</a></li>
                <li><a href="#architecture">2. 시스템 아키텍처</a></li>
                <li><a href="#data-flow">3. 데이터 처리 흐름</a></li>
                <li><a href="#modules">4. 모듈별 상세 분석</a></li>
                <li><a href="#logic">5. 핵심 로직 상세</a></li>
                <li><a href="#outputs">6. 산출물 명세</a></li>
                <li><a href="#review">7. 코드 리뷰 및 평가</a></li>
                <li><a href="#improvements">8. 개선 권고사항</a></li>
            </ul>
        </nav>

        <!-- 1. 프로젝트 개요 -->
        <section id="overview">
            <h2>1. 프로젝트 개요</h2>

            <h3>1.1 목적</h3>
            <p>올리브영에서 수집한 토너 제품 리뷰 데이터(27,745건, 7개 브랜드)를 분석하여 PM(Product Manager)에게 유의미한 인사이트를 제공하는 자동화 분석 시스템</p>

            <h3>1.2 분석 대상 브랜드</h3>
            <div style="margin: 15px 0;">
                <span class="badge badge-primary">토리든 (8,065건)</span>
                <span class="badge badge-primary">브링그린 (6,312건)</span>
                <span class="badge badge-primary">독도토너 (3,750건)</span>
                <span class="badge badge-primary">아누아 (3,544건)</span>
                <span class="badge badge-primary">에스네이처 (2,232건)</span>
                <span class="badge badge-primary">토니모리 (2,195건)</span>
                <span class="badge badge-primary">아비브 (1,647건)</span>
            </div>

            <h3>1.3 핵심 기능</h3>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="number">4</div>
                    <div class="label">분석 축<br>(효능/사용감/사용법/가치)</div>
                </div>
                <div class="metric-card">
                    <div class="number">5</div>
                    <div class="label">산출물<br>(그래프/차트/문장)</div>
                </div>
                <div class="metric-card">
                    <div class="number">17</div>
                    <div class="label">Python 모듈</div>
                </div>
                <div class="metric-card">
                    <div class="number">AI</div>
                    <div class="label">GPT-4o-mini<br>보정 지원</div>
                </div>
            </div>
        </section>

        <!-- 2. 시스템 아키텍처 -->
        <section id="architecture">
            <h2>2. 시스템 아키텍처</h2>

            <h3>2.1 디렉토리 구조</h3>
            <pre>
review_analysis/
├── config/
│   ├── __init__.py
│   ├── keywords.py          # 키워드 딕셔너리 (핵심 설정)
│   └── .env                  # API 키 (CLASSIFICATION_REVIEW)
├── src/
│   ├── __init__.py
│   ├── data_loader.py        # 데이터 로딩/전처리
│   ├── sentiment_analyzer.py # 감성/강도 분석
│   ├── tag_extractor.py      # 태그 추출
│   ├── switch_detector.py    # 전환 신호 탐지
│   └── ai_enhancer.py        # AI 보정 (GPT-4o-mini)
├── analysis/
│   ├── __init__.py
│   ├── neutral_rate.py       # 3-A: 무난/애매 점유율
│   ├── positioning_map.py    # 3-B: 포지셔닝 맵
│   ├── positioning_sentence.py # 3-C: 포지셔닝 문장
│   ├── rebuy_analysis.py     # 3-D: 재구매 분석
│   └── switch_matrix.py      # 3-E: 전환 매트릭스
├── data/
│   └── 올영리뷰데이터_utf8.json  # 원본 데이터
├── output/
│   ├── processed_reviews.csv # 처리된 데이터
│   ├── ai_token_usage.json   # AI 토큰 사용량
│   └── figures/              # 시각화 결과
├── main.py                   # 메인 실행 스크립트
├── analysis_deep.py          # 심층 분석 (Pain Point, 재구매/이탈, 트렌드)
└── requirements.txt          # 의존성
            </pre>

            <h3>2.2 모듈 의존성 그래프</h3>
            <div class="flow-diagram">
                <div class="flow-step">config/keywords.py</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">src/*</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">analysis/*</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">main.py</div>
            </div>

            <h3>2.3 기술 스택</h3>
            <table>
                <tr>
                    <th>구분</th>
                    <th>기술</th>
                    <th>버전</th>
                    <th>용도</th>
                </tr>
                <tr>
                    <td>언어</td>
                    <td>Python</td>
                    <td>3.12+</td>
                    <td>전체 시스템</td>
                </tr>
                <tr>
                    <td>데이터 처리</td>
                    <td>Pandas</td>
                    <td>2.0+</td>
                    <td>데이터프레임 처리</td>
                </tr>
                <tr>
                    <td>시각화</td>
                    <td>Matplotlib, Seaborn</td>
                    <td>3.7+, 0.12+</td>
                    <td>그래프 생성</td>
                </tr>
                <tr>
                    <td>AI</td>
                    <td>OpenAI API (GPT-4o-mini)</td>
                    <td>-</td>
                    <td>감성 분석 보정</td>
                </tr>
                <tr>
                    <td>환경설정</td>
                    <td>python-dotenv</td>
                    <td>-</td>
                    <td>API 키 관리</td>
                </tr>
            </table>
        </section>

        <!-- 3. 데이터 처리 흐름 -->
        <section id="data-flow">
            <h2>3. 데이터 처리 흐름</h2>

            <h3>3.1 전체 파이프라인</h3>
            <div class="flow-diagram">
                <div class="flow-step" style="background: #dbeafe;">
                    <strong>Step 1</strong><br>
                    데이터 로딩<br>
                    <small>JSON/CSV 파싱</small>
                </div>
                <span class="flow-arrow">→</span>
                <div class="flow-step" style="background: #d1fae5;">
                    <strong>Step 2</strong><br>
                    변수 추출<br>
                    <small>감성/태그/전환</small>
                </div>
                <span class="flow-arrow">→</span>
                <div class="flow-step" style="background: #fef3c7;">
                    <strong>Step 2.5</strong><br>
                    AI 보정<br>
                    <small>GPT-4o-mini</small>
                </div>
                <span class="flow-arrow">→</span>
                <div class="flow-step" style="background: #ede9fe;">
                    <strong>Step 3</strong><br>
                    산출물 생성<br>
                    <small>5개 분석 모듈</small>
                </div>
            </div>

            <h3>3.2 입력 데이터 스키마</h3>
            <table>
                <tr>
                    <th>컬럼명</th>
                    <th>타입</th>
                    <th>설명</th>
                    <th>예시</th>
                </tr>
                <tr>
                    <td><code>BRAND_NAME</code></td>
                    <td>string</td>
                    <td>브랜드명</td>
                    <td>"토리든"</td>
                </tr>
                <tr>
                    <td><code>REVIEW_CONTENT</code></td>
                    <td>string</td>
                    <td>리뷰 본문</td>
                    <td>"촉촉하고 진정 효과가 좋아요"</td>
                </tr>
                <tr>
                    <td><code>REVIEW_RATING</code></td>
                    <td>int</td>
                    <td>별점 (1-5)</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td><code>REVIEWER_INFO</code></td>
                    <td>string</td>
                    <td>리뷰어 정보 (피부타입, 퍼스널컬러)</td>
                    <td>"복합성, 봄웜톤, 모공"</td>
                </tr>
                <tr>
                    <td><code>PURCHASE_TAG</code></td>
                    <td>string</td>
                    <td>구매 태그</td>
                    <td>"재구매"</td>
                </tr>
                <tr>
                    <td><code>REVIEW_ADDITIONAL_INFO</code></td>
                    <td>JSON string</td>
                    <td>제품 추천 대상 정보</td>
                    <td>{"피부타입":"복합성에 좋아요", ...}</td>
                </tr>
                <tr>
                    <td><code>REVIEW_DATE</code></td>
                    <td>datetime</td>
                    <td>리뷰 작성일</td>
                    <td>"2025-01-04T15:00:00.000Z"</td>
                </tr>
                <tr>
                    <td><code>REVIEW_ID</code></td>
                    <td>int</td>
                    <td>리뷰 고유 ID</td>
                    <td>261198529</td>
                </tr>
            </table>

            <h3>3.3 추출 변수 (Step 2 산출)</h3>
            <table>
                <tr>
                    <th>변수명</th>
                    <th>타입</th>
                    <th>가능한 값</th>
                    <th>추출 로직</th>
                </tr>
                <tr>
                    <td><code>sentiment</code></td>
                    <td>string</td>
                    <td>POS / NEU / NEG</td>
                    <td>별점 + 키워드 기반</td>
                </tr>
                <tr>
                    <td><code>strength</code></td>
                    <td>string</td>
                    <td>STRONG / MID / WEAK</td>
                    <td>강조 표현 기반</td>
                </tr>
                <tr>
                    <td><code>benefit_tags</code></td>
                    <td>list</td>
                    <td>[진정, 보습, 장벽, 결, 피지]</td>
                    <td>키워드 매칭</td>
                </tr>
                <tr>
                    <td><code>texture_tags</code></td>
                    <td>list</td>
                    <td>[물같음, 쫀쫀, 끈적, 흡수]</td>
                    <td>키워드 매칭</td>
                </tr>
                <tr>
                    <td><code>usage_tags</code></td>
                    <td>list</td>
                    <td>[닦토, 스킨팩, 레이어링, 바디]</td>
                    <td>키워드 매칭</td>
                </tr>
                <tr>
                    <td><code>value_tags</code></td>
                    <td>list</td>
                    <td>[가성비, 무난, 애매, 인생템]</td>
                    <td>키워드 매칭</td>
                </tr>
                <tr>
                    <td><code>reason_buy</code></td>
                    <td>string</td>
                    <td>가성비 / 진정 / 보습 / 대용량 / 기타</td>
                    <td>우선순위 매칭</td>
                </tr>
                <tr>
                    <td><code>switch_signal</code></td>
                    <td>int</td>
                    <td>0 / 1</td>
                    <td>전환 키워드 탐지</td>
                </tr>
                <tr>
                    <td><code>switch_to_brand</code></td>
                    <td>string</td>
                    <td>브랜드명</td>
                    <td>경쟁 브랜드 매칭</td>
                </tr>
            </table>
        </section>

        <!-- 4. 모듈별 상세 분석 -->
        <section id="modules">
            <h2>4. 모듈별 상세 분석</h2>

            <h3>4.1 Config 모듈</h3>
            <div class="module-card">
                <h4>config/keywords.py</h4>
                <p><strong>역할:</strong> 모든 분석의 기반이 되는 키워드 딕셔너리 정의</p>
                <p><strong>정의된 딕셔너리:</strong></p>
                <table>
                    <tr>
                        <th>딕셔너리명</th>
                        <th>키(태그) 수</th>
                        <th>용도</th>
                    </tr>
                    <tr>
                        <td><code>BENEFIT_KEYWORDS</code></td>
                        <td>5개 (진정/보습/장벽/결/피지)</td>
                        <td>효능 태그 추출</td>
                    </tr>
                    <tr>
                        <td><code>TEXTURE_KEYWORDS</code></td>
                        <td>4개 (물같음/쫀쫀/끈적/흡수)</td>
                        <td>사용감 태그 추출</td>
                    </tr>
                    <tr>
                        <td><code>USAGE_KEYWORDS</code></td>
                        <td>4개 (닦토/스킨팩/레이어링/바디)</td>
                        <td>사용법 태그 추출</td>
                    </tr>
                    <tr>
                        <td><code>VALUE_KEYWORDS</code></td>
                        <td>4개 (가성비/무난/애매/인생템)</td>
                        <td>가치 태그 추출</td>
                    </tr>
                    <tr>
                        <td><code>POSITIVE_KEYWORDS</code></td>
                        <td>17개</td>
                        <td>긍정 감성 판정</td>
                    </tr>
                    <tr>
                        <td><code>NEGATIVE_KEYWORDS</code></td>
                        <td>15개</td>
                        <td>부정 감성 판정</td>
                    </tr>
                    <tr>
                        <td><code>STRONG_MARKERS</code></td>
                        <td>12개</td>
                        <td>강한 감정 표현</td>
                    </tr>
                    <tr>
                        <td><code>WEAK_MARKERS</code></td>
                        <td>7개</td>
                        <td>약한 감정 표현</td>
                    </tr>
                    <tr>
                        <td><code>SWITCH_KEYWORDS</code></td>
                        <td>13개</td>
                        <td>전환 신호 탐지</td>
                    </tr>
                    <tr>
                        <td><code>COMPETITOR_BRANDS</code></td>
                        <td>16개</td>
                        <td>경쟁 브랜드 매칭</td>
                    </tr>
                </table>
            </div>

            <h3>4.2 Source 모듈 (src/)</h3>

            <div class="module-card">
                <h4>src/data_loader.py</h4>
                <p><strong>역할:</strong> 데이터 로딩 및 전처리</p>
                <p><strong>주요 함수:</strong></p>
                <ul>
                    <li><code>load_and_preprocess(file_path)</code> - CSV/JSON 자동 인식 로딩, JSON 파싱, 날짜 변환</li>
                    <li><code>get_brand_summary(df)</code> - 브랜드별 요약 통계</li>
                </ul>
                <p><strong>핵심 로직:</strong> REVIEW_ADDITIONAL_INFO JSON 파싱하여 피부타입/피부고민/자극도 컬럼 추출</p>
            </div>

            <div class="module-card">
                <h4>src/sentiment_analyzer.py</h4>
                <p><strong>역할:</strong> 감성(POS/NEU/NEG) 및 강도(STRONG/MID/WEAK) 분석</p>
                <p><strong>주요 함수:</strong></p>
                <ul>
                    <li><code>analyze_sentiment(text, rating)</code> - 별점 기반 1차 판정 + 키워드 보정</li>
                    <li><code>analyze_strength(text)</code> - 강조 표현 기반 강도 판정</li>
                </ul>
                <p><strong>핵심 로직:</strong></p>
                <pre>
# 별점 기반 1차 판정
if rating >= 4: base = "POS"
elif rating <= 2: base = "NEG"
else: base = "NEU"

# 키워드 기반 보정
if neg_count >= 2 and base == "POS": return "NEU"
if pos_count >= 2 and base == "NEU": return "POS"</pre>
            </div>

            <div class="module-card">
                <h4>src/tag_extractor.py</h4>
                <p><strong>역할:</strong> 키워드 딕셔너리 기반 태그 추출</p>
                <p><strong>주요 함수:</strong></p>
                <ul>
                    <li><code>extract_tags(text, keyword_dict)</code> - 범용 태그 추출</li>
                    <li><code>extract_benefit_tags(text)</code> - 효능 태그</li>
                    <li><code>extract_texture_tags(text)</code> - 사용감 태그</li>
                    <li><code>extract_usage_tags(text)</code> - 사용법 태그</li>
                    <li><code>extract_reason_buy(text)</code> - 구매 이유 (우선순위 1개)</li>
                </ul>
                <p><strong>핵심 로직:</strong> 태그당 한 번만 추가 (중복 방지)</p>
            </div>

            <div class="module-card">
                <h4>src/switch_detector.py</h4>
                <p><strong>역할:</strong> 브랜드 전환 신호 탐지</p>
                <p><strong>주요 함수:</strong></p>
                <ul>
                    <li><code>detect_switch_signal(text)</code> - 전환 키워드 포함 여부 (0/1)</li>
                    <li><code>extract_switch_brand(text)</code> - 전환 대상 브랜드 추출</li>
                </ul>
            </div>

            <div class="module-card">
                <h4>src/ai_enhancer.py</h4>
                <p><strong>역할:</strong> GPT-4o-mini를 사용한 AI 감성 분석 보정</p>
                <p><strong>주요 함수:</strong></p>
                <ul>
                    <li><code>select_ambiguous_reviews(df, max_samples)</code> - 애매한 리뷰 샘플링</li>
                    <li><code>call_gpt_api(client, text, review_id, token_log)</code> - API 호출</li>
                    <li><code>enhance_with_ai(df, output_dir)</code> - 전체 AI 보정 파이프라인</li>
                </ul>
                <p><strong>샘플링 기준 (우선순위 점수):</strong></p>
                <table>
                    <tr><th>조건</th><th>점수</th></tr>
                    <tr><td>NEU(중립) 판정</td><td>+3점</td></tr>
                    <tr><td>별점-내용 불일치</td><td>+2점</td></tr>
                    <tr><td>긴 리뷰 + 태그 미추출</td><td>+1점</td></tr>
                </table>
                <p><strong>비용 관리:</strong> max_samples 제한 (기본 3,000건), 토큰 사용량 JSON 로깅</p>
            </div>

            <h3>4.3 Analysis 모듈 (analysis/)</h3>

            <div class="module-card">
                <h4>analysis/neutral_rate.py (3-A)</h4>
                <p><strong>역할:</strong> 브랜드별 무난/애매 키워드 점유율 분석</p>
                <p><strong>산출물:</strong> 막대그래프 (3A_neutral_rate.png)</p>
                <p><strong>인사이트:</strong> 무난↑ → 차별성 약화, 애매↑ → 효능 인지 부족</p>
            </div>

            <div class="module-card">
                <h4>analysis/positioning_map.py (3-B)</h4>
                <p><strong>역할:</strong> 키워드 언급률 기반 2D 포지셔닝 맵 생성</p>
                <p><strong>산출물:</strong></p>
                <ul>
                    <li>효능 맵: 진정 vs 보습 (3B_positioning_benefit.png)</li>
                    <li>사용감 맵: 물같음 vs 쫀쫀 (3B_positioning_texture.png)</li>
                </ul>
                <p><strong>시각화:</strong> 평균선으로 4사분면 구분, 브랜드별 색상 구분</p>
            </div>

            <div class="module-card">
                <h4>analysis/positioning_sentence.py (3-C)</h4>
                <p><strong>역할:</strong> 브랜드별 포지셔닝 문장 자동 생성</p>
                <p><strong>템플릿:</strong> "{타겟피부}이 {핵심효능}을 위해 쓰는 {사용역할} 토너"</p>
                <p><strong>예시:</strong> "복합성이 보습/진정을 위해 쓰는 레이어링 토너"</p>
            </div>

            <div class="module-card">
                <h4>analysis/rebuy_analysis.py (3-D)</h4>
                <p><strong>역할:</strong> 재구매 이유 분석</p>
                <p><strong>산출물:</strong> 브랜드별 파이차트, 비교 막대그래프</p>
                <p><strong>인사이트:</strong></p>
                <ul>
                    <li>습관/가성비 → 성장 정체 가능성</li>
                    <li>효능/안전성 → 팬덤 확장 가능</li>
                </ul>
            </div>

            <div class="module-card">
                <h4>analysis/switch_matrix.py (3-E)</h4>
                <p><strong>역할:</strong> 브랜드 간 고객 전환 시나리오 분석</p>
                <p><strong>산출물:</strong> 히트맵 매트릭스 (From → To)</p>
                <p><strong>핵심 지표:</strong> 전환 신호 감지율, 주요 전환 패턴</p>
            </div>

            <h3>4.4 심층 분석 모듈</h3>

            <div class="module-card">
                <h4>analysis_deep.py</h4>
                <p><strong>역할:</strong> 추가 심층 분석 (기존 5개 산출물 외)</p>
                <p><strong>분석 내용:</strong></p>
                <ol>
                    <li><strong>Pain Point 분석:</strong> 저평점(1-2점) 리뷰에서 불만 키워드 추출
                        <ul>
                            <li>자극/트러블, 보습부족, 끈적/무거움, 효과없음, 향/냄새, 가격, 용기/패키지, 흡수불량</li>
                        </ul>
                    </li>
                    <li><strong>재구매/이탈 분석:</strong> 충성(loyal), 재구매(rebuy), 이탈(churn) 신호 탐지</li>
                    <li><strong>월별 키워드 트렌드:</strong> 진정/보습/각질/끈적/산뜻/가성비 언급률 월별 추이</li>
                </ol>
            </div>
        </section>

        <!-- 5. 핵심 로직 상세 -->
        <section id="logic">
            <h2>5. 핵심 로직 상세</h2>

            <h3>5.1 감성 분석 로직</h3>
            <div class="alert alert-info">
                <strong>2단계 판정 방식:</strong> 별점 기반 1차 판정 → 키워드 기반 보정
            </div>
            <pre>
def analyze_sentiment(text, rating):
    # Step 1: 별점 기반 1차 판정
    if rating >= 4:      base = "POS"   # 4-5점 → 긍정
    elif rating <= 2:    base = "NEG"   # 1-2점 → 부정
    else:                base = "NEU"   # 3점 → 중립

    # Step 2: 키워드 카운트
    pos_count = count_keywords(text, POSITIVE_KEYWORDS)
    neg_count = count_keywords(text, NEGATIVE_KEYWORDS)

    # Step 3: 보정 규칙
    if neg_count >= 2 and base == "POS":
        return "NEU"  # 부정 표현 2개 이상이면 중립으로 하향

    if pos_count >= 2 and base == "NEU":
        return "POS"  # 긍정 표현 2개 이상이면 긍정으로 상향

    return base</pre>

            <h3>5.2 태그 추출 로직</h3>
            <pre>
def extract_tags(text, keyword_dict):
    found_tags = []

    for tag, keywords in keyword_dict.items():
        for kw in keywords:
            if kw in text:
                found_tags.append(tag)
                break  # 한 태그당 한 번만 추가 (중복 방지)

    return found_tags

# 예시: "진정되고 촉촉해요" → ["진정", "보습"]</pre>

            <h3>5.3 AI 샘플링 로직</h3>
            <pre>
def select_ambiguous_reviews(df, max_samples=3000):
    df['_score'] = 0

    # 우선순위 점수 부여
    df.loc[df['sentiment'] == 'NEU', '_score'] += 3           # NEU 판정
    df.loc[(df['REVIEW_RATING'] == 5) &
           (df['strength'] == 'WEAK'), '_score'] += 2         # 5점인데 WEAK
    df.loc[(df['REVIEW_RATING'] <= 2) &
           (df['strength'] == 'STRONG'), '_score'] += 2       # 1-2점인데 STRONG
    df.loc[no_tags_condition, '_score'] += 1                  # 긴 리뷰인데 태그 없음

    # 점수 1점 이상만 선택, 상한 적용
    return df[df['_score'] >= 1].head(max_samples)</pre>

            <h3>5.4 포지셔닝 문장 생성 로직</h3>
            <pre>
템플릿: "{타겟피부}이 {핵심효능}을 위해 쓰는 {사용역할} 토너"

구성 요소:
- 타겟피부: REVIEW_ADDITIONAL_INFO의 피부타입 최빈값
- 핵심효능: benefit_tags Top 2
- 사용역할: usage_tags Top 1

예시 결과:
- 토리든: "복합성이 보습/진정을 위해 쓰는 레이어링 토너"
- 브링그린: "복합성이 진정/보습을 위해 쓰는 닦토 토너"</pre>
        </section>

        <!-- 6. 산출물 명세 -->
        <section id="outputs">
            <h2>6. 산출물 명세</h2>

            <h3>6.1 데이터 산출물</h3>
            <table>
                <tr>
                    <th>파일명</th>
                    <th>형식</th>
                    <th>내용</th>
                </tr>
                <tr>
                    <td>output/processed_reviews.csv</td>
                    <td>CSV</td>
                    <td>모든 추출 변수가 추가된 리뷰 데이터</td>
                </tr>
                <tr>
                    <td>output/ai_token_usage.json</td>
                    <td>JSON</td>
                    <td>AI API 토큰 사용량 로그 (비용 추적)</td>
                </tr>
            </table>

            <h3>6.2 시각화 산출물</h3>
            <table>
                <tr>
                    <th>파일명</th>
                    <th>유형</th>
                    <th>내용</th>
                </tr>
                <tr>
                    <td>3A_neutral_rate.png</td>
                    <td>막대그래프</td>
                    <td>브랜드별 무난/애매 점유율 비교</td>
                </tr>
                <tr>
                    <td>3B_positioning_benefit.png</td>
                    <td>산점도</td>
                    <td>진정 vs 보습 효능 포지셔닝 맵</td>
                </tr>
                <tr>
                    <td>3B_positioning_texture.png</td>
                    <td>산점도</td>
                    <td>물같음 vs 쫀쫀 사용감 포지셔닝 맵</td>
                </tr>
                <tr>
                    <td>3D_rebuy_comparison.png</td>
                    <td>막대그래프</td>
                    <td>브랜드별 재구매 이유 비교</td>
                </tr>
                <tr>
                    <td>3D_rebuy_{브랜드}.png</td>
                    <td>파이차트</td>
                    <td>브랜드별 재구매 이유 분포</td>
                </tr>
                <tr>
                    <td>3E_switch_matrix.png</td>
                    <td>히트맵</td>
                    <td>브랜드 간 전환 매트릭스</td>
                </tr>
            </table>
        </section>

        <!-- 7. 코드 리뷰 및 평가 -->
        <section id="review">
            <h2>7. 코드 리뷰 및 평가</h2>

            <h3>7.1 전체 평가</h3>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="number" style="color: var(--success);">A-</div>
                    <div class="label">전체 등급</div>
                </div>
                <div class="metric-card">
                    <div class="number">85%</div>
                    <div class="label">코드 품질</div>
                </div>
                <div class="metric-card">
                    <div class="number">90%</div>
                    <div class="label">모듈화</div>
                </div>
                <div class="metric-card">
                    <div class="number">80%</div>
                    <div class="label">확장성</div>
                </div>
            </div>

            <h3>7.2 상세 평가</h3>
            <div class="pros-cons">
                <div class="pros">
                    <h4>장점 (Strengths)</h4>
                    <ul>
                        <li><strong>명확한 모듈 분리:</strong> config/src/analysis 3계층 구조로 역할 분리</li>
                        <li><strong>유지보수 용이:</strong> 키워드 딕셔너리 분리로 튜닝 쉬움</li>
                        <li><strong>비용 관리:</strong> AI 샘플링 전략, 토큰 로깅 구현</li>
                        <li><strong>에러 처리:</strong> JSON 파싱, 데이터 로딩 등 예외 처리</li>
                        <li><strong>확장성:</strong> 새 분석 모듈 추가 용이</li>
                        <li><strong>문서화:</strong> 함수별 docstring, 명확한 변수명</li>
                        <li><strong>시각화:</strong> 한글 폰트 자동 감지, 플랫폼 대응</li>
                    </ul>
                </div>
                <div class="cons">
                    <h4>개선점 (Weaknesses)</h4>
                    <ul>
                        <li><strong>테스트 부재:</strong> 단위 테스트 코드 없음</li>
                        <li><strong>타입 힌트 부재:</strong> 함수 시그니처에 타입 명시 없음</li>
                        <li><strong>로깅 미흡:</strong> print 대신 logging 모듈 사용 권장</li>
                        <li><strong>설정 분산:</strong> 일부 설정이 코드에 하드코딩</li>
                        <li><strong>중복 코드:</strong> 한글 폰트 설정 여러 파일에 반복</li>
                        <li><strong>병렬 처리 없음:</strong> 대용량 데이터 처리 시 속도 이슈</li>
                    </ul>
                </div>
            </div>

            <h3>7.3 모듈별 코드 품질</h3>
            <table>
                <tr>
                    <th>모듈</th>
                    <th>라인 수</th>
                    <th>함수 수</th>
                    <th>복잡도</th>
                    <th>등급</th>
                </tr>
                <tr>
                    <td>config/keywords.py</td>
                    <td>~110</td>
                    <td>0 (데이터만)</td>
                    <td>낮음</td>
                    <td><span class="badge badge-success">A</span></td>
                </tr>
                <tr>
                    <td>src/data_loader.py</td>
                    <td>~100</td>
                    <td>2</td>
                    <td>중간</td>
                    <td><span class="badge badge-success">A</span></td>
                </tr>
                <tr>
                    <td>src/sentiment_analyzer.py</td>
                    <td>~100</td>
                    <td>3</td>
                    <td>낮음</td>
                    <td><span class="badge badge-success">A</span></td>
                </tr>
                <tr>
                    <td>src/tag_extractor.py</td>
                    <td>~145</td>
                    <td>8</td>
                    <td>낮음</td>
                    <td><span class="badge badge-success">A</span></td>
                </tr>
                <tr>
                    <td>src/switch_detector.py</td>
                    <td>~70</td>
                    <td>3</td>
                    <td>낮음</td>
                    <td><span class="badge badge-success">A</span></td>
                </tr>
                <tr>
                    <td>src/ai_enhancer.py</td>
                    <td>~300</td>
                    <td>5</td>
                    <td>높음</td>
                    <td><span class="badge badge-primary">B+</span></td>
                </tr>
                <tr>
                    <td>analysis/neutral_rate.py</td>
                    <td>~150</td>
                    <td>3</td>
                    <td>중간</td>
                    <td><span class="badge badge-success">A</span></td>
                </tr>
                <tr>
                    <td>analysis/positioning_map.py</td>
                    <td>~170</td>
                    <td>3</td>
                    <td>중간</td>
                    <td><span class="badge badge-success">A-</span></td>
                </tr>
                <tr>
                    <td>analysis/positioning_sentence.py</td>
                    <td>~130</td>
                    <td>5</td>
                    <td>낮음</td>
                    <td><span class="badge badge-success">A</span></td>
                </tr>
                <tr>
                    <td>analysis/rebuy_analysis.py</td>
                    <td>~200</td>
                    <td>5</td>
                    <td>중간</td>
                    <td><span class="badge badge-primary">B+</span></td>
                </tr>
                <tr>
                    <td>analysis/switch_matrix.py</td>
                    <td>~200</td>
                    <td>6</td>
                    <td>중간</td>
                    <td><span class="badge badge-success">A-</span></td>
                </tr>
                <tr>
                    <td>main.py</td>
                    <td>~250</td>
                    <td>1</td>
                    <td>높음</td>
                    <td><span class="badge badge-primary">B</span></td>
                </tr>
            </table>

            <h3>7.4 보안 검토</h3>
            <div class="alert alert-success">
                <strong>결과:</strong> 보안 이슈 없음
            </div>
            <ul>
                <li>API 키: .env 파일 분리 (gitignore 권장)</li>
                <li>입력 검증: JSON 파싱 시 예외 처리</li>
                <li>SQL Injection: 해당 없음 (파일 기반)</li>
                <li>Path Traversal: pathlib 사용으로 안전</li>
            </ul>
        </section>

        <!-- 8. 개선 권고사항 -->
        <section id="improvements">
            <h2>8. 개선 권고사항</h2>

            <h3>8.1 단기 개선 (Quick Wins)</h3>
            <table>
                <tr>
                    <th>우선순위</th>
                    <th>개선 항목</th>
                    <th>현재 상태</th>
                    <th>권고 사항</th>
                </tr>
                <tr>
                    <td><span class="badge badge-danger">P1</span></td>
                    <td>한글 폰트 설정 중복</td>
                    <td>5개 파일에 반복</td>
                    <td>config/plot_config.py로 통합</td>
                </tr>
                <tr>
                    <td><span class="badge badge-danger">P1</span></td>
                    <td>로깅 개선</td>
                    <td>print() 사용</td>
                    <td>logging 모듈 + 파일 출력</td>
                </tr>
                <tr>
                    <td><span class="badge badge-warning">P2</span></td>
                    <td>타입 힌트 추가</td>
                    <td>없음</td>
                    <td>함수 시그니처에 타입 명시</td>
                </tr>
                <tr>
                    <td><span class="badge badge-warning">P2</span></td>
                    <td>설정 파일 통합</td>
                    <td>하드코딩</td>
                    <td>config/settings.py 또는 YAML</td>
                </tr>
            </table>

            <h3>8.2 중기 개선 (Architecture)</h3>
            <table>
                <tr>
                    <th>우선순위</th>
                    <th>개선 항목</th>
                    <th>설명</th>
                </tr>
                <tr>
                    <td><span class="badge badge-warning">P2</span></td>
                    <td>단위 테스트</td>
                    <td>pytest 기반 테스트 코드 작성, 키워드 매칭 정확도 검증</td>
                </tr>
                <tr>
                    <td><span class="badge badge-warning">P2</span></td>
                    <td>CLI 인터페이스</td>
                    <td>argparse 또는 click으로 옵션 처리 (--brand, --output 등)</td>
                </tr>
                <tr>
                    <td><span class="badge badge-purple">P3</span></td>
                    <td>병렬 처리</td>
                    <td>concurrent.futures로 AI API 호출 병렬화</td>
                </tr>
                <tr>
                    <td><span class="badge badge-purple">P3</span></td>
                    <td>캐싱</td>
                    <td>AI 분석 결과 캐싱으로 재실행 시 비용 절감</td>
                </tr>
            </table>

            <h3>8.3 키워드 딕셔너리 개선 제안</h3>
            <div class="alert alert-warning">
                <strong>현재 한계:</strong> 수동 정의된 키워드는 신조어, 줄임말, 오타에 대응 불가
            </div>
            <table>
                <tr>
                    <th>카테고리</th>
                    <th>추가 권장 키워드</th>
                </tr>
                <tr>
                    <td>진정</td>
                    <td>뾰루지, 좁쌀, 염증, 홍조, 속진정</td>
                </tr>
                <tr>
                    <td>보습</td>
                    <td>수분폭탄, 꿀피부, 물광, 차오름</td>
                </tr>
                <tr>
                    <td>사용감</td>
                    <td>찰랑, 슥슥, 쫀득, 묵직</td>
                </tr>
                <tr>
                    <td>전환 신호</td>
                    <td>갈아탈, 환승, 졸업, 입문</td>
                </tr>
            </table>

            <h3>8.4 분석 로직 개선 제안</h3>
            <ul>
                <li><strong>감성 분석:</strong> 부정어 처리 추가 ("안 좋아요" → NEG)</li>
                <li><strong>태그 추출:</strong> 문맥 고려 (끈적 + 않아 → 끈적 태그 제외)</li>
                <li><strong>전환 탐지:</strong> 방향성 파악 (From → To 명확화)</li>
                <li><strong>시계열:</strong> 계절성 분석 추가 (겨울 = 보습↑, 여름 = 산뜻↑)</li>
            </ul>

            <h3>8.5 코드 리팩토링 예시</h3>
            <pre>
# Before: 한글 폰트 설정 반복
# neutral_rate.py, positioning_map.py, rebuy_analysis.py, switch_matrix.py

# After: config/plot_config.py
import matplotlib.pyplot as plt
import platform

def setup_korean_font():
    """한글 폰트 설정 (플랫폼 자동 감지)"""
    system = platform.system()
    font_map = {
        'Windows': 'Malgun Gothic',
        'Darwin': 'AppleGothic',
        'Linux': 'NanumGothic'
    }
    plt.rcParams['font.family'] = font_map.get(system, 'NanumGothic')
    plt.rcParams['axes.unicode_minus'] = False

# 사용: from config.plot_config import setup_korean_font</pre>
        </section>

        <section>
            <h2>9. 결론</h2>
            <div class="alert alert-success">
                <p><strong>종합 평가:</strong> 이 프로젝트는 명확한 목적을 가진 실용적인 리뷰 분석 시스템입니다.
                모듈화가 잘 되어 있고, 키워드 기반 분석과 AI 보정을 적절히 조합하여 비용 효율적인 분석이 가능합니다.</p>

                <p><strong>즉시 활용 가능:</strong> 현재 상태로 PM 인사이트 도출에 충분히 활용 가능합니다.</p>

                <p><strong>향후 발전 방향:</strong> 테스트 코드 추가, CLI 인터페이스 개선, 실시간 대시보드 연동을 통해
                프로덕션 수준의 시스템으로 발전할 수 있습니다.</p>
            </div>
        </section>
    </div>

    <footer>
        <p>리뷰 분석 프로젝트 코드 분석 및 기획서</p>
        <p>Generated by Claude Code | 2026-01-27</p>
    </footer>
</body>
</html>
