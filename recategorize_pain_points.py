# -*- coding: utf-8 -*-
"""
Pain Points 재분류 - 유사한 표현 통합
"""
import json
import sys

sys.stdout.reconfigure(encoding='utf-8')

# Pain Points 매핑 (유사 표현 → 대표 표현)
PAIN_MAPPING = {
    # === 건조/보습 부족 ===
    '건조함': '건조/보습부족',
    '속건조': '건조/보습부족',
    '수분감 부족': '건조/보습부족',
    '수분 부족': '건조/보습부족',
    '보습 부족': '건조/보습부족',
    '촉촉함 부족': '건조/보습부족',
    '보습력 부족': '건조/보습부족',
    '보습감 부족': '건조/보습부족',
    '겨울에 건조함': '건조/보습부족',
    '조금 건조함': '건조/보습부족',
    '겨울에 사용 시 건조함': '건조/보습부족',
    '촉촉하지 않음': '건조/보습부족',
    '겨울철 건조함': '건조/보습부족',
    '수분 충전 부족': '건조/보습부족',
    '건조한 느낌': '건조/보습부족',
    '수분감이 부족함': '건조/보습부족',
    '보습감이 부족함': '건조/보습부족',
    '겨울에는 건조': '건조/보습부족',
    '건조해짐': '건조/보습부족',
    '건조': '건조/보습부족',
    '수분감 없음': '건조/보습부족',
    '보습력이 약함': '건조/보습부족',
    '촉촉하지 않다': '건조/보습부족',
    '건조하다': '건조/보습부족',
    '건조해요': '건조/보습부족',
    '건조할 수 있음': '건조/보습부족',
    '보습이 부족함': '건조/보습부족',
    '보습 효과 부족': '건조/보습부족',
    '겨울철 보습 부족': '건조/보습부족',
    '건성 피부에는 비추천': '건조/보습부족',
    '보습이 약함': '건조/보습부족',
    '수분감 부족함': '건조/보습부족',
    '겨울에 부족': '건조/보습부족',
    '보습이 아쉬움': '건조/보습부족',
    '촉촉함이 부족': '건조/보습부족',
    '건조함이 있음': '건조/보습부족',
    '보습력이 부족함': '건조/보습부족',
    '보습력 없음': '건조/보습부족',
    '건성에게는 부족': '건조/보습부족',

    # === 자극/따가움 ===
    '자극': '자극/따가움',
    '따가움': '자극/따가움',
    '피부 자극': '자극/따가움',
    '자극적': '자극/따가움',
    '자극감': '자극/따가움',
    '피부 따가움': '자극/따가움',
    '자극이 있음': '자극/따가움',
    '약간의 자극': '자극/따가움',
    '피부에 자극': '자극/따가움',
    '자극적임': '자극/따가움',
    '살짝 따가움': '자극/따가움',
    '따끔거림': '자극/따가움',
    '따끔함': '자극/따가움',
    '자극있음': '자극/따가움',

    # === 눈 자극 ===
    '눈에 들어가면 따가움': '눈 자극',
    '눈에 들어가면 아픔': '눈 자극',
    '눈에 들어가면 매움': '눈 자극',
    '눈가 자극': '눈 자극',
    '눈 주변 따가움': '눈 자극',
    '눈에 자극': '눈 자극',
    '눈 시림': '눈 자극',
    '눈 따가움': '눈 자극',
    '눈에 닿으면 따가움': '눈 자극',
    '눈 주변 자극': '눈 자극',

    # === 가격 ===
    '가격이 비쌈': '가격 불만',
    '비싼 가격': '가격 불만',
    '가격 상승': '가격 불만',
    '가격': '가격 불만',
    '가격이 올랐음': '가격 불만',
    '가격 인상': '가격 불만',
    '비쌈': '가격 불만',
    '가격이 비싸다': '가격 불만',
    '가격 부담': '가격 불만',
    '비싸다': '가격 불만',

    # === 효과 부족 ===
    '효과 부족': '효과 부족/미흡',
    '효과 없음': '효과 부족/미흡',
    '효과 불확실': '효과 부족/미흡',
    '기대 이하': '효과 부족/미흡',
    '기대에 미치지 못함': '효과 부족/미흡',
    '효과 미비': '효과 부족/미흡',
    '효과가 없음': '효과 부족/미흡',
    '효과 모름': '효과 부족/미흡',
    '효과를 모르겠음': '효과 부족/미흡',
    '기대에 못 미침': '효과 부족/미흡',
    '드라마틱한 효과 부족': '효과 부족/미흡',
    '기대했던 효과 없음': '효과 부족/미흡',
    '효과 잘 모르겠음': '효과 부족/미흡',
    '효과가 미미함': '효과 부족/미흡',
    '큰 효과 없음': '효과 부족/미흡',
    '특별한 효과 없음': '효과 부족/미흡',
    '효과 모르겠음': '효과 부족/미흡',

    # === 진정 효과 부족 ===
    '진정 효과 부족': '진정효과 부족',
    '진정효과 부족': '진정효과 부족',
    '진정 효과 미비': '진정효과 부족',
    '진정 효과 없음': '진정효과 부족',
    '진정 효과가 부족함': '진정효과 부족',

    # === 트러블/피부 문제 ===
    '트러블 발생': '트러블/뾰루지',
    '여드름 발생': '트러블/뾰루지',
    '피부 트러블': '트러블/뾰루지',
    '트러블': '트러블/뾰루지',
    '피부 뒤집어짐': '트러블/뾰루지',
    '뾰루지 발생': '트러블/뾰루지',
    '뾰루지': '트러블/뾰루지',
    '피부 문제': '트러블/뾰루지',
    '올라옴': '트러블/뾰루지',
    '트러블이 생김': '트러블/뾰루지',
    '피부 트러블 발생': '트러블/뾰루지',
    '좁쌀 여드름 발생': '트러블/뾰루지',
    '좁쌀여드름': '트러블/뾰루지',
    '여드름': '트러블/뾰루지',
    '뾰루지가 생김': '트러블/뾰루지',
    '피부 올라옴': '트러블/뾰루지',
    '트러블이 남': '트러블/뾰루지',
    '좁쌀': '트러블/뾰루지',
    '좁쌀여드름 발생': '트러블/뾰루지',
    '피부가 뒤집어짐': '트러블/뾰루지',
    '여드름 악화': '트러블/뾰루지',
    '피부 뒤집힘': '트러블/뾰루지',
    '각질': '트러블/뾰루지',
    '피지': '트러블/뾰루지',

    # === 냄새/향 ===
    '냄새': '냄새/향 불만',
    '향': '냄새/향 불만',
    '향이 강함': '냄새/향 불만',
    '냄새가 남': '냄새/향 불만',
    '향이 아쉬움': '냄새/향 불만',
    '알코올 냄새': '냄새/향 불만',
    '인공적인 향': '냄새/향 불만',
    '향이 별로': '냄새/향 불만',
    '향 아쉬움': '냄새/향 불만',
    '냄새가 별로': '냄새/향 불만',

    # === 끈적임 ===
    '끈적임': '끈적임/흡수불량',
    '끈적거림': '끈적임/흡수불량',
    '흡수 잘 안됨': '끈적임/흡수불량',
    '겉도는 느낌': '끈적임/흡수불량',
    '흡수가 안됨': '끈적임/흡수불량',
    '흡수력 부족': '끈적임/흡수불량',
    '끈적함': '끈적임/흡수불량',
    '흡수 문제': '끈적임/흡수불량',
    '흡수 느림': '끈적임/흡수불량',
    '흡수가 느림': '끈적임/흡수불량',
    '흡수 안됨': '끈적임/흡수불량',
    '미끌거림': '끈적임/흡수불량',
    '미끌미끌': '끈적임/흡수불량',

    # === 기름짐/유분 ===
    '기름짐': '유분/기름짐',
    '유분감': '유분/기름짐',
    '유분기': '유분/기름짐',
    '번들거림': '유분/기름짐',
    '기름기': '유분/기름짐',

    # === 가려움 ===
    '가려움': '가려움/알러지',
    '가려움증': '가려움/알러지',
    '간지러움': '가려움/알러지',
    '알레르기': '가려움/알러지',
    '알러지': '가려움/알러지',

    # === 용량 ===
    '용량 부족': '용량 불만',
    '용량이 작음': '용량 불만',
    '용량이 적음': '용량 불만',
    '양이 적음': '용량 불만',
    '소용량': '용량 불만',

    # === 피부 안맞음 ===
    '피부에 맞지 않음': '피부 안맞음',
    '피부에 안맞음': '피부 안맞음',
    '안맞음': '피부 안맞음',
}

def recategorize_pain_points():
    print("Pain Points 재분류 시작...")

    # 데이터 로드
    with open('output/gpt_analysis_categorized.json', 'r', encoding='utf-8') as f:
        cat_data = json.load(f)

    print(f"총 {len(cat_data):,}건 분석 데이터")

    # 재분류 전 통계
    before_pain = {}
    for r in cat_data:
        for p in r.get('pain_points', []):
            before_pain[p] = before_pain.get(p, 0) + 1
    print(f"재분류 전 고유 Pain Points: {len(before_pain)}개")

    # 재분류 적용
    mapped_count = 0
    for r in cat_data:
        new_pain_points = []
        for p in r.get('pain_points', []):
            if p in PAIN_MAPPING:
                new_pain_points.append(PAIN_MAPPING[p])
                mapped_count += 1
            else:
                new_pain_points.append(p)
        # 중복 제거 (같은 카테고리로 매핑된 경우)
        r['pain_points'] = list(dict.fromkeys(new_pain_points))

    print(f"매핑 적용: {mapped_count}건")

    # 재분류 후 통계
    after_pain = {}
    for r in cat_data:
        for p in r.get('pain_points', []):
            after_pain[p] = after_pain.get(p, 0) + 1
    print(f"재분류 후 고유 Pain Points: {len(after_pain)}개")

    # 저장
    with open('output/gpt_analysis_categorized.json', 'w', encoding='utf-8') as f:
        json.dump(cat_data, f, ensure_ascii=False, indent=2)

    print("\n=== 재분류 후 TOP 20 Pain Points ===")
    sorted_after = sorted(after_pain.items(), key=lambda x: -x[1])
    for i, (p, c) in enumerate(sorted_after[:20], 1):
        print(f"{i}. {p}: {c}건")

    return after_pain


if __name__ == "__main__":
    recategorize_pain_points()
